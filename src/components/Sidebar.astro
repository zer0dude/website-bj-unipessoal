---
import LanguageSwitcher from './LanguageSwitcher.astro';
import { getCurrentLocale, type Locale } from '../i18n/translations';

// Detect current locale and get appropriate navigation URLs
const currentLocale = getCurrentLocale(Astro.url);
---

<aside
  data-animation="default"
  data-collapse="medium"
  data-duration="400"
  data-easing="ease"
  data-easing2="ease"
  role="banner"
  class="sidebar w-nav"
>
  <div class="nav-content">
    <a href="/" class="w-nav-brand" aria-label="home">
      <div class="niv-data">
        <img
          src="/assets/sam.jpg"
          loading="eager"
          alt="Profile picture"
          class="niv-image"
        />
        <div>
          <div class="label-white">Brian Jin</div>
          <div class="label-gray">Applied AI Engineer</div>
        </div>
      </div>
    </a>

    <nav role="navigation" class="w-nav-menu">
      <a
        href={currentLocale === 'en' ? '/en/#hero' : '/#hero'}
        class="nav-link-container w-inline-block"
      >
        <img
          src="/assets/home.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>Home</div>
      </a>
      
      <a
        href={currentLocale === 'en' ? '/en/#portfolio' : '/#portfolio'}
        class="nav-link-container w-inline-block"
      >
        <img
          src="/assets/favorite.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>Portfolio</div>
      </a>
      
      <!-- Portfolio sub-items (indented) -->
      <a
        href={currentLocale === 'en' ? '/en/portfolio/project-1' : '/portfolio/project-1'}
        class="nav-link-container nav-link-sub w-inline-block"
      >
        <img
          src="/assets/code.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>E-commerce Platform</div>
      </a>
      
      <a
        href={currentLocale === 'en' ? '/en/portfolio/project-2' : '/portfolio/project-2'}
        class="nav-link-container nav-link-sub w-inline-block"
      >
        <img
          src="/assets/database.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>SaaS Dashboard</div>
      </a>
      
      <a
        href={currentLocale === 'en' ? '/en/portfolio/project-3' : '/portfolio/project-3'}
        class="nav-link-container nav-link-sub w-inline-block"
      >
        <img
          src="/assets/browser.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>Mobile App</div>
      </a>
      
      <a
        href={currentLocale === 'en' ? '/en/#about' : '/#about'}
        class="nav-link-container w-inline-block"
      >
        <img
          src="/assets/home.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>About</div>
      </a>
      
      <a
        href={currentLocale === 'en' ? '/en/#contact' : '/#contact'}
        class="nav-link-container w-inline-block"
      >
        <img
          src="/assets/dns.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>Contact</div>
      </a>
    </nav>

    <!-- Language Switcher -->
    <div class="language-switcher-container">
      <LanguageSwitcher />
    </div>

    <div
      class="navbar-icon-button w-nav-button"
      style="-webkit-user-select: text;"
      aria-label="menu"
      role="button"
      tabindex="0"
    >
      <img
        src="/assets/menu.svg"
        loading="eager"
        alt=""
        class="navbar-icon"
      />
    </div>
  </div>

  <script>
    import { setupNav } from '../scripts/navigation.js';
    
    let cleanup;
    document.addEventListener('astro:page-load', () => {
      if (cleanup) cleanup();
      cleanup = setupNav();
    });

    document.addEventListener('astro:before-swap', () => {
      if (cleanup) cleanup();
    });
  </script>
</aside>
